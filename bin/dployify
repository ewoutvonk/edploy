#!/usr/bin/env ruby

# Copyright (c) 2009-2012 by Ewout Vonk. All rights reserved.

require 'open3'
require 'dployify'

abort "Please run this command from the Rails.root" unless File.file?('config/routes.rb')
RAILS_ROOT = Dir.getwd

if ARGV.include?('prefs')
	Dployify::Preferences.configure
else
	Dployify::Project.before_capify_clean
	Open3.popen3("capify .") do
		puts "Running `capify .'"
	end
	Dployify::Project.after_capify_clean
	Dployify::Template.make_dirs
	Dployify::Configuration.configure
	Dployify::Template.generate_templates(Dployify::Configuration.binding)
	puts "[done] dployified!"
end

